# **Homework 2: ค้นคว้าเรื่อง Code Smells ตามที่กำหนดให้รายบุคคล**

## **Name and ID:**

- **Name:**  นายสัณหธรรศน์ จึงธีรพานิช
- **ID:**    66102010154

## **หัวข้อ Dead Code**

### **ความหมายของ Dead Code**

Dead Code คือ Variable, Parameter, Field, Method หรือ Class บางอย่างที่**ไม่ได้ใช้งาน**อีกต่อไปแล้ว โดยปกติเพราะมันเกิดความล่าสมัย (เก่า) แล้ว

#### **สาเหตุของปัญหา (Reason for the Problem)**

เมื่อ requirements ของ software นั้นเปลี่ยนไป และไม่มีใครมา clean หรือจัดการกับ code เก่า ๆ โดยส่วนใหญ่จะพบตาม Conditionals ที่มีความซับซ้อน และมี branch ที่ไม่เกิดการเข้าถึง (unreachable)

#### **แนวทางการปรับปรุง**
- วิธีที่**เร็วที่สุด**ในการหา Dead Code คือการใช้ IDE ที่ดี
- ลบโค้ดที่ไม่ได้ใช้งานและไฟล์ที่ไม่จำเป็นออก
- ในกรณีที่ Class ไม่จำเป็น (unnecessary class) สามารถใช้ Inline Class หรือ Collapse Hirarchy ได้หากยังมีการใช้ sunclass หรือ superclass
- หากต้องการลบ parameter ที่ไม่ต้องการแล้ว ให้ใช้ **Remove Parameter**

#### **ประโยชน์หลังจากการแก้ไข Dead Code**
- ลดขนาดของโค้ดลง
- ทำให้การดูแลโค้ดนั้นง่ายขึ้น

### **ตัวอย่างโค้ดที่เกิด Code Smell**

```
public class OrderSystem
{
    // 1. Unused Field: ฟิลด์ที่ประกาศไว้แต่ไม่ได้ใช้งานเลย
    private string _temporaryId;

    public decimal CalculateTotal(decimal price, int quantity)
    {
        // 2. Unused Variable: ตัวแปรที่คำนวณไว้แต่ไม่ได้ถูกนำไปใช้ต่อ
        decimal taxRate = 0.07m;
        decimal discount = 10.0m; 

        if (price <= 0)
        {
            return 0;
            // 3. Unreachable Code: โค้ดที่อยู่หลัง return จะไม่มีวันทำงาน
            Console.WriteLine("Price must be greater than zero."); 
        }

        decimal total = price * quantity;

        // 4. Impossible Condition: เงื่อนไขที่เป็นเท็จเสมอ (Logically Impossible)
        if (quantity < 0 && quantity > 100)
        {
            total -= 5; 
        }

        return total;
    }

    // 5. Unused Method: Method ที่เป็น private และไม่มีใครในคลาสเรียกใช้
    private void LogDebugInfo(string message)
    {
        Console.WriteLine($"[DEBUG]: {message}");
    }
}
```

1. **Unused Field (_temporaryId):** _temporaryId ถูกประกาศไว้ แต่ไม่ได้มีการเรียกใช้เลย ซึ่งก็จะทำให้ของของโค้ดนั้นใหญ่ขึ้นโดยไม่จำเป็น
2. **Unused Variable (discount):** ตัวแปร discount นั้นมีการประกาศพร้อมกับกำหนดค่าให้เรียบร้อย แต่กลับไม่ได้มีการนำไปใช้เลยใน method ของตัวเอง
3. **Unreachable Code (หลัง return 0):** คำสั่ง **Console.WriteLine("Price must be greater than zero.");** ไม่มีทางที่จะถูก Run แน่นอนเพราะโปรแกรมจะกระโดดออกจาก Method ทันทีที่เจอ **return 0**
4. **Impossible Condition:** Logic นี้ quantity ไม่มีทางที่จะมีค่าน้อยกว่า 0 และมากกว่า 100 ได้ในเวลาเดียวกัน เพราะฉะนั้น branch นี้จะไม่มีทางเกิดขึ้นจริงได้
5. **Unused Method (LogDebugInfo):** method นี้ถูกตั้งให้เป็น private แล้วทำให้ไม่มีคนเรียกใช้ใน class ตัวเอง ซึ่งเปลืองพื้นที่ดี ๆ นี่เอง หากเป็น public ก็อาจจะมี class อื่นมาเรียกใช้ได้

ปล.โค้ดข้างต้นใช้ภาษา C#

### **ตัวอย่างโค้ดที่ refactoring แล้ว**

```
public class OrderSystem
{
    // กำจัด Unused Field (_temporaryId) ออกไป

    public decimal CalculateTotal(decimal price, int quantity)
    {
        // กำจัด Unused Variable (taxRate, discount) ออกไป 
        // หากต้องการใช้งานในอนาคต ค่อยเพิ่มกลับมาเมื่อถึงเวลา

        if (price <= 0)
        {
            // ย้ายคำสั่งมาไว้ก่อน return เพื่อให้โค้ดทำงานได้จริง (แก้ Unreachable Code)
            Console.WriteLine("Price must be greater than zero."); 
            return 0;
        }

        // เก็บไว้เฉพาะส่วนที่ใช้คำนวณจริง
        decimal total = price * quantity;

        // ลบ Impossible Condition ออก เพราะไม่มีทางที่เงื่อนไขจะเป็นจริงได้
        
        return total;
    }

    // ลบ Unused Method ออก เพื่อให้คลาสสะอาดและสื่อสารเฉพาะหน้าที่ของมันจริงๆ
}
```

1. **ลบตัวแปรและฟิลด์ที่ไม่ได้ใช้ (Noise Reduction):** ลบตัวแปร taxRate, discount และฟิล์ด _temporaryId ที่ไม่ได้ใช้ ซึ่งช่วยให้ programmer คนอื่น ๆ ไม่ต้องมาเสียเวลานั่งเช็คว่าตัวแปรพวกนี้เอาไว้ใช้ทำอะไร
2. **ลำดับการทำงานให้ถูกต้อง (Logical Flow):** ย้าย **Console.WriteLine("Price must be greater than zero.");** ขึ้นมาไว้ก่อน **return 0** เพื่อให้ข้อความแจ้งเตือนได้ใช้งานจริง (เดิมเป็น Unreachable Code)
3. **ตัดทิ้งส่วนที่เกิน (Pruning):** ลบ condition **quantity < 0 && quantity > 100** ออก เพราะ condition นี้ไม่มีทางเป็นจริง 
4. **ลดขนาดไฟล์:** ลบ method **LogDebugInfo** ที่ไม่มีใครใช้ออก ช่วยลดขนาดไฟล์และยังทำให้ class ดู focus และทำงานตามหน้าที่ได้ชัดเจนยิ่งขึ้น (Single Responsobility)

### **กรณีที่ code smell นี้ไม่ได้บ่งบอกถึงโค้ดที่มีปัญหา** (กรณีที่ไม่จำเป็นต้อง refactoring)

ในโลกความเป็นจริง การพัฒนา software มีบางสถานการณ์ที่โค้ดดูเหมือน **"ไม่ได้ถูกใช้งาน"** นั้นมีเหตุผลที่ยังต้องคงอยุ่ต่อไป และการลบทิ้งอาจส่งผลร้ายมากกว่าผลดี

มี 3 กรณีศึกษาที่การมี Dead Code (หรือโค้ดที่ดูเหมือนไม่ได้ใช้) เป็นเรื่องที่ยอมรับได้
#### **1. การทำ Public API หรีอ Shared Library**
```
public class MathLibrary
{
    // ในโปรเจกต์ของคุณอาจจะใช้แค่บวกกับลบ
    public int Add(int a, int b) => a + b;
    public int Subtract(int a, int b) => a - b;

    // Method นี้ไม่มีที่ไหนในโปรเจกต์เรียกใช้เลย (Dead code สำหรับเรา)
    // แต่ "ห้ามลบ" เพราะมันเป็นส่วนหนึ่งของ API ที่คนอื่นต้องใช้งาน
    public int Multiply(int a, int b) => a * b;
}
```

สมมติว่าคุณกำลังเขียน Class เพื่อส่งต่อให้คนอื่นมาใช้ เช่นการสร้าง DLL หรือ Library คุณอาจมี method ที่ตัวโปรเจกต์ของคุณเองไม่ได้เรียกใช้เลย แต่คุณลบทิ้งไม่ได้ เพราะ **"ผู้ใช้งาน (USers)"** ของคุณเป็นคนเรียกใช้

#### **2. ข้อกำหนดของ Framework หรือ Contract (Boilerplate)**
```
public class UserProfile
{
    public string Username { get; set; }

    // Parameterless Constructor: 
    // ในโค้ดเราอาจจะใช้แต่ Constructor ที่มี Parameter 
    // แต่เราต้องเก็บตัวนี้ไว้เพื่อให้ Library (เช่น JSON Deserializer) สามารถสร้าง Object นี้ได้
    public UserProfile() { } 

    public UserProfile(string username)
    {
        Username = username;
    }
}
```

บางครั้ง Framework (เช่น Entity Framework, ASP.NET Core หรือการทำ Serialization) บังคับว่าคุณจะต้องมี method หรือ constructor บางอย่างไว้ ถึงแม้คุณจะไม่ได้เรียกใช้มันโดยตรงในโค้ดของคุณก็ตาม

#### **3. โค้ดสำหรับระบบความปลอดภัย หรือ Diagnostic (Just-in-case)**
```
public void ProcessTransaction(Transaction tx)
{
    if (tx == null) return;

    Execute(tx);

    // ส่วนนี้อาจดูเหมือน Dead code เพราะระบบออกแบบมาไม่ให้ Transaction ล้มเหลวที่จุดนี้
    // แต่เราใส่ไว้เพื่อเป็น "Safety Net" หรือเก็บ Log กรณีเกิดเหตุสุดวิสัยจริงๆ
    if (tx.Status == Status.CriticalError)
    {
        LogToSecretSecurityServer(tx); // แทบไม่ได้รัน แต่ลบไม่ได้เพื่อความปลอดภัย
    }
}
```

บางครั้งเราเขียนโค้ดเผื่อไว้สำหรับกรณีที่ **"ไม่ควรจะเกิดขึ้น"** หรือใช้สำหรับการตรวจสอบปัญหาหน้างาน (On-site troubleshooting) ซึ่งในสภาวะปกติแล้ว โค้ดส่วนนี้จะไม่มีวันทำงานเลย

### **เมื่อไหร่ที่ไม่ต้องลบ Dead Code (แถม)**

| **สถานการณ์** | **เหตุผลที่ไม่ควร Refactoring/Delete** |
|---|---|
| **Public API** | เพื่อรักษา Compatibility (ความเข้ากันได้) ให้กับผู้ใช้งานคนอื่น ๆ |
| **Framework Requirements** | เพื่อให้เครื่องมือหรือ Library ภายนอกทำงานร่วมกับโค้ดของเราได้ |
| **Feature Toggles** | โค้ดที่รอการเปิดใช้งานในอนาคต |
| **Defensive Programming** | โค้ดดักจับ Error ร้ายแรงที่โอกาสเกิดน้อยมาก แต่ถ้าเกิดแล้วต้องแจ้งให้มีคนรู้|
